name: App

on:
  pull_request:
    branches: master
jobs:
  php-unit-tests:
          runs-on: ubuntu-latest
          steps:
              - uses: actions/checkout@v2
              - name: Copy ENV Laravel Configuration for CI
                run: php -r "file_exists('.env') || copy('.env.ci', '.env');"
              - name: Install Dependencies (PHP vendors)
                run: composer install -q --no-ansi --no-interaction --no-scripts --no-suggest --no-progress --prefer-dist
              - name: Generate key
                run: php artisan key:generate
              - name: Create DB and schemas
                run: |
                  mkdir -p database
                  touch database/database.sqlite
                  php artisan migrate
              - name: Execute tests (Unit and Feature tests) via PHPUnit
                run: vendor/bin/phpunit
      
  phpinsights:
        runs-on: ubuntu-latest
        name: PHP Insights checks
        steps:
            - uses: actions/checkout@v2
            - uses: shivammathur/setup-php@v1
              with:
                  php-version: 8.0
            - run: composer install --prefer-dist --no-progress --no-suggest
            - run: vendor/bin/phpinsights -n --ansi --format=github-action
            
  php-cs-fixer:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2

            - name: Install
              run: composer install

            - name: Run php-cs-fixer
              run: ./vendor/bin/php-cs-fixer fix

            - uses: stefanzweifel/git-auto-commit-action@v4
              with:
                  commit_message: Apply php-cs-fixer changes

    
